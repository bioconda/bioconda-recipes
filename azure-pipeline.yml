pr:
  autoCancel: true
trigger:
  branches:
    exclude:
      - master
      - "*"

stages:
  - stage: "Testing"
    jobs:
      - job: "Testing"
        pool:
          vmImage: "ubuntu-latest"

        steps:
          - checkout: none
          - bash: |
              set -xeu
              for image in \
                quay.io/bioconda/base-glibc-busybox-bash:3 \
                quay.io/bioconda/base-glibc-debian-bash:3 \
                quay.io/bioconda/create-env:3 \
                quay.io/bioconda/bioconda-utils-build-env-cos7:2.13.2 \
                quay.io/condaforge/linux-anvil-cos7-x86_64:latest \
                docker.io/library/centos:7 \
                quay.io/condaforge/mambaforge:latest \
                docker.io/continuumio/miniconda3:latest \
                ; do
                for shell in sh bash ; do
                  for run_opts in '' '--entrypoint=' ; do
                    for opts in '' '-l' '-i' '-li' ; do
                      docker run --rm --quiet ${run_opts} "${image}" "${shell}" ${opts} -c umask 2> /dev/null
                    done
                  done
                done
              done
              exit 1
