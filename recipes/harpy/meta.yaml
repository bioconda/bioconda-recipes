{% set name = "harpy" %}
{% set version = "3.1" %}
{% set sha256 = "5e11993420449a3a00300dd87a34715b5205b65cb850b4a4e4e5167f881f8e9c" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  url: https://github.com/pdimens/harpy/archive/{{ version }}.tar.gz
  sha256: {{ sha256 }}

build:
  number: 1
  noarch: python
  script_env:
    - SETUPTOOLS_SCM_PRETEND_VERSION={{ version }}
  script: {{ PYTHON }} -m pip install . --no-deps --no-build-isolation --no-cache-dir -vvv
  entry_points:
    - harpy = harpy.__main__:cli
    - assign_mi = harpy.scripts:assign_mi.main
    - bx_stats = harpy.scripts:bx_stats.main
    - bx_to_end = harpy.scripts:bx_to_end.main
    - check_bam = harpy.scripts:check_bam.main
    - check_fastq = harpy.scripts:check_fastq.main
    - concatenate_bam = harpy.scripts:concatenate_bam.main
    - count_bx = harpy.scripts:count_bx.main
    - create_simulation_data = harpy.scripts:create_simulation_data.main
    - deconvolve_alignments = harpy.scripts:deconvolve_alignments.main
    - depth_windows = harpy.scripts:depth_windows.main
    - extract_bxtags = harpy.scripts:extract_bxtags.main
    - haplotag_acbd = harpy.scripts:haplotag_acbd.main
    - haplotag_barcodes = harpy.scripts:haplotag_barcodes.main
    - infer_sv = harpy.scripts:infer_sv.main
    - make_windows = harpy.scripts:make_windows.main
    - molecule_coverage = harpy.scripts:molecule_coverage.main
    - parse_phaseblocks = harpy.scripts:parse_phaseblocks.main
    - rename_bam = harpy.scripts:rename_bam.main
    - standardize_barcodes_sam = harpy.scripts:standardize_barcodes_sam.main
  run_exports:
    - {{ pin_subpackage('harpy', max_pin="x") }}

requirements:
  host:
    - python >=3.11
    - pip
    - setuptools-scm >=8
  run:
    - python >=3.11
    - bcftools >=1.22
    - conda >24.7
    - djinn >=1.1
    - htslib >=1.22
    - pysam >=0.23
    - rich-click >=1.9.3
    - snakemake-minimal >=9.10
    - samtools >=1.22
    - seqtk

test:
  commands:
    - "snakemake --version"
    - "harpy --version"

about:
  home: "https://github.com/pdimens/harpy"
  license: "GPL-3.0-or-later"
  license_family: GPL3
  license_file: LICENSE
  summary: "Process raw haplotagging data, from raw sequences to phased haplotypes."
  description: |
    Harpy is a command-line tool to easily process platform-agnostic linked-read or WGS data. It uses
    Snakemake under the hood to execute different workflows (quality control, trimming, 
    alignment, variant calling, phasing, etc.), but the user is rarely, if ever, exposed
    to Snakemake directly. With an emphasis on user-friendliness, parallelization, transparency,
    and reproducibility, Harpy quickly handles data processing so that you can focus more
    on analyzing your data. 
  doc_url: "https://pdimens.github.io/harpy"
  dev_url: "https://github.com/pdimens/harpy"

extra:
  recipe-maintainers:
    - pdimens
