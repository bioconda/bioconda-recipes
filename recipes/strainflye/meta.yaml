{% set name = "strainFlye" %}
{% set version = "0.2.0" %}

package:
  name: "{{ name|lower }}"
  version: "{{ version }}"

source:
  # Note the "v" before the version number -- we prefix strainFlye's release
  # tags with a "v" (e.g. "v0.2.0"), so we need to include the "v" here in
  # order to point to the correct tags. (However, although a tag might be named
  # "v0.2.0", the actual version is still "0.2.0", hence why we don't just
  # include the "v" in the version variable.)
  #
  # For comparison, flye's meta.yaml
  # (https://github.com/bioconda/bioconda-recipes/blob/master/recipes/flye/meta.yaml)
  # does not do this because its release tags are (mostly) not prefixed with a "v".
  url: "https://github.com/fedarko/strainFlye/archive/v{{ version }}.tar.gz"
  sha256: "7e67ff0c24cd9a3cc850e268de5931e78bc808e5c6da7f61cd1ce29c9bc2ae79"

build:
  number: 0
  noarch: python
  script: "{{ PYTHON }} -m pip install . -vv"

requirements:
  host:
    - python >=3.6,<3.8
    - cython >=0.29.12
    - setuptools
    - pip
    - numpy
    - scipy >=1.0
    # attempting to just "pip install" pysam / pysamstats has caused problems
    # before, so we include them up here (rather than just in "run")
    - pysam <0.16
    - pysamstats
    # We need to install samtools / htslib alongside pysam -- and in particular
    # we need a version of these tools that pysam is ok with. It seems like a
    # samtools version < 1.10 is ok with pysam < 0.16: see
    # https://github.com/bioconda/bioconda-recipes/blob/master/recipes/pysam/0.15.2/meta.yaml
    # (for context, using htslib 1.16 gives us an error when trying to import
    # pysam saying "ImportError: libhts.so.2: cannot open shared object file:
    # No such file or directory" (this issue is also described in
    # https://github.com/MikkelSchubert/paleomix/issues/38)
    - samtools >=1.7,<1.10
    # also let's install bcftools up here while we're at it
    - bcftools
  run:
    - python >=3.6,<3.8
    - numpy
    - scipy >=1.0
    # we directly use both pysam and pysamstats at multiple places in the code
    - pysam <0.16
    - pysamstats
    # Non-python dependencies (used through Python's subprocess module)
    - samtools >=1.7,<1.10
    - bcftools
    - minimap2 >=2.10
    - prodigal
    # Misc. python dependencies
    - scikit-bio
    - networkx
    - pandas >=1.0
    - click >=8.0

test:
  commands:
    - strainFlye
  imports:
    - strainflye

about:
  home: "https://github.com/fedarko/strainFlye"
  license: BSD-3-Clause
  license_family: BSD
  license_file: LICENSE
  summary: "Pipeline for analyzing rare mutations in metagenomes assembled using long and accurate reads"

extra:
  recipe-maintainers:
    - fedarko
