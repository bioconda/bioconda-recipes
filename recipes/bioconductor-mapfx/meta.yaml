{% set version = "1.6.3" %}
{% set name = "MAPFX" %}
{% set bioc = "3.22" %}

package:
  name: bioconductor-{{ name|lower }}
  version: '{{ version }}'

source:
  url:
    - https://bioconductor.org/packages/{{ bioc }}/bioc/src/contrib/{{ name }}_{{ version }}.tar.gz
    - https://bioconductor.org/packages/{{ bioc }}/bioc/src/contrib/Archive/{{ name }}/{{ name }}_{{ version }}.tar.gz
    - https://bioarchive.galaxyproject.org/{{ name }}_{{ version }}.tar.gz
    - https://depot.galaxyproject.org/software/bioconductor-{{ name|lower }}/bioconductor-{{ name|lower }}_{{ version }}_src_all.tar.gz
  md5: 63d01efa3c01dcef50294c7e0808cc5c

build:
  number: 0
  rpaths:
    - lib/R/lib/
    - lib/
  run_exports: '{{ pin_subpackage("bioconductor-mapfx", max_pin="x.x") }}'
  noarch: generic

# Suggests: BiocStyle, knitr, rmarkdown, testthat
requirements:
  host:
    - bioconductor-biobase >=2.70.0,<2.71.0
    - bioconductor-complexheatmap >=2.26.0,<2.27.0
    - bioconductor-flowcore >=2.22.0,<2.23.0
    - r-base
    - r-circlize
    - r-cowplot
    - r-e1071
    - r-ggplot2
    - r-glmnetutils
    - r-gtools
    - r-icellr
    - r-igraph
    - r-pbapply
    - r-rcolorbrewer
    - r-reshape2
    - r-rfast
    - r-stringr
    - r-uwot
    - r-xgboost >=3.0.0
  run:
    - bioconductor-biobase >=2.70.0,<2.71.0
    - bioconductor-complexheatmap >=2.26.0,<2.27.0
    - bioconductor-flowcore >=2.22.0,<2.23.0
    - r-base
    - r-circlize
    - r-cowplot
    - r-e1071
    - r-ggplot2
    - r-glmnetutils
    - r-gtools
    - r-icellr
    - r-igraph
    - r-pbapply
    - r-rcolorbrewer
    - r-reshape2
    - r-rfast
    - r-stringr
    - r-uwot
    - r-xgboost >=3.0.0

test:
  commands:
    - $R -e "library('{{ name }}')"

about:
  home: https://bioconductor.org/packages/{{ bioc }}/bioc/html/{{ name }}.html
  license: GPL-2
  summary: 'MAssively Parallel Flow cytometry Xplorer (MAPFX): A Toolbox for Analysing Data from the Massively-Parallel Cytometry Experiments'
  description: MAPFX is an end-to-end toolbox that pre-processes the raw data from MPC experiments (e.g., BioLegend's LEGENDScreen and BD Lyoplates assays), and further imputes the ‘missing’ infinity markers in the wells without those measurements. The pipeline starts by performing background correction on raw intensities to remove the noise from electronic baseline restoration and fluorescence compensation by adapting a normal-exponential convolution model. Unwanted technical variation, from sources such as well effects, is then removed using a log-normal model with plate, column, and row factors, after which infinity markers are imputed using the informative backbone markers as predictors. The completed dataset can then be used for clustering and other statistical analyses. Additionally, MAPFX can be used to normalise data from FFC assays as well.
  license_file: '{{ environ["PREFIX"] }}/lib/R/share/licenses/GPL-2'

