{% set name = "dbcanlight" %}
{% set version = "1.1.1" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/chtsai0105/{{ name }}/archive/refs/tags/v{{ version }}.tar.gz
  sha256: ef48baed2d34f7863d1ce91130936c3aaafa2f0c49290bcbb69854fb4742e66d

build:
  number: 0
  noarch: python
  script: {{ PYTHON }} -m pip install . --no-deps --no-build-isolation --no-cache-dir -vvv
  entry_points:
    - dbcanlight = dbcanlight.__main__:main
    - dbcanlight-hmmparser = dbcanlight.hmmsearch_parser:main
    - dbcanlight-subparser = dbcanlight.substrate_parser:main
  run_exports:
      - {{ pin_subpackage(name|lower, max_pin="x") }}

requirements:
  host:
    - pip
    - python >=3.9
    - setuptools >=61.0
  run:
    - biopython >=1.81
    - pyhmmer >=0.11.0
    - python >=3.9
    - urllib3 >=2.3.0
    - importlib-metadata  # [py<310]

test:
  commands:
    - dbcanlight -h
    - dbcanlight-hmmparser -h
    - dbcanlight-subparser -h

about:
  home: https://github.com/chtsai0105/dbcanlight
  license: MIT
  license_family: MIT
  license_file: LICENSE
  summary: A lightweight CAZyme annotation tool
  description: |
    Dbcanlight is a lightweight rewrite of a widely used CAZyme annotation tool run_dbcan. It uses pyhmmer, a Cython binding to
    HMMER3, in place of the HMMER3 CLI suite as the backend for search processes, improving multithreading performance. In
    addition, it removes a limitation in run_dbcan that required manual splitting of large sequence files beforehand.

    The main program dbcanlight comprises three modules - build, search and conclude. The build module help to download the
    required databases from dbcan website; the search module searches against protein HMM, substrate HMM or diamond databases and
    reports the hits separately; and the conclude module gathers all the results made by each module and provides a summary. The
    output format closely resembles that of run_dbcan, with minor cleanup. For example, run_dbcan may report the same substrate
    multiple times for a gene matching several profiles with that substrate, whereas dbcanlight reports it only once.

    Dbcanlight only reimplemented the core features of run_dbcan, that is searching for CAZyme and substrate matches by
    hmmer/diamond/dbcansub. Submodules like signalP, CGCFinder, etc. are not implemented.
  dev_url: https://github.com/chtsai0105/dbcanlight
  doc_url: https://github.com/chtsai0105/dbcanlight/blob/v{{ version }}/README.md

extra:
  recipe-maintainers:
    - chtsai0105
  identifies:
    - 10.5281/zenodo.13586881
