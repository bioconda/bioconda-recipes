diff --git a/SequelQC/RCvalidate_smrtlink_isoseq.py b/SequelQC/RCvalidate_smrtlink_isoseq.py
index 76cf1f9..00e66ff 100644
--- a/SequelQC/RCvalidate_smrtlink_isoseq.py
+++ b/SequelQC/RCvalidate_smrtlink_isoseq.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 __version__ = '1.2'
 
diff --git a/SequelQC/RCvalidate_smrtlink_isoseq_mm10.py b/SequelQC/RCvalidate_smrtlink_isoseq_mm10.py
index a2ba0dd..d597d71 100644
--- a/SequelQC/RCvalidate_smrtlink_isoseq_mm10.py
+++ b/SequelQC/RCvalidate_smrtlink_isoseq_mm10.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 __version__ = '1.2'
 
diff --git a/SequelQC/RCvalidate_tofu2_isoseq.py b/SequelQC/RCvalidate_tofu2_isoseq.py
index 407d8ae..0df9e3c 100644
--- a/SequelQC/RCvalidate_tofu2_isoseq.py
+++ b/SequelQC/RCvalidate_tofu2_isoseq.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.coatchAn'
 __version__ = '1.2'
 
diff --git a/SequelQC/SIRVvalidate_smrtlink_isoseq.py b/SequelQC/SIRVvalidate_smrtlink_isoseq.py
index e2367af..7ad8d63 100644
--- a/SequelQC/SIRVvalidate_smrtlink_isoseq.py
+++ b/SequelQC/SIRVvalidate_smrtlink_isoseq.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 __version__ = '2.0'
 
diff --git a/SequelQC/SIRVvalidate_tofu2_isoseq.py b/SequelQC/SIRVvalidate_tofu2_isoseq.py
index 6e27339..4f30c2c 100644
--- a/SequelQC/SIRVvalidate_tofu2_isoseq.py
+++ b/SequelQC/SIRVvalidate_tofu2_isoseq.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 __version__ = '2.0'
 
diff --git a/SequelQC/SMRTLink_stats_isoseq.py b/SequelQC/SMRTLink_stats_isoseq.py
index 23fdf20..a0230b3 100644
--- a/SequelQC/SMRTLink_stats_isoseq.py
+++ b/SequelQC/SMRTLink_stats_isoseq.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
 import os, sys, glob, datetime
@@ -179,4 +180,4 @@ if __name__ == "__main__":
     args = parser.parse_args()
 
     sample = os.path.basename(os.getcwd())
-    gather_all_reports(args.smrtlink_dir, sample)
\ No newline at end of file
+    gather_all_reports(args.smrtlink_dir, sample)
diff --git a/SequelQC/SMRTLink_subread_stats.py b/SequelQC/SMRTLink_subread_stats.py
index 24733f6..d9fb9f3 100644
--- a/SequelQC/SMRTLink_subread_stats.py
+++ b/SequelQC/SMRTLink_subread_stats.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
 
diff --git a/annotation/alignment_stats_from_sam.py b/annotation/alignment_stats_from_sam.py
index 8206822..c0b9f0d 100644
--- a/annotation/alignment_stats_from_sam.py
+++ b/annotation/alignment_stats_from_sam.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
 """
diff --git a/cupcake/tofu/compare_junctions.py b/cupcake/tofu/compare_junctions.py
index 0f43d68..cfb0892 100644
--- a/cupcake/tofu/compare_junctions.py
+++ b/cupcake/tofu/compare_junctions.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
 import pdb
diff --git a/cupcake/tofu/counting/chain_fusion_samples.py b/cupcake/tofu/counting/chain_fusion_samples.py
index 20043f9..397dadb 100644
--- a/cupcake/tofu/counting/chain_fusion_samples.py
+++ b/cupcake/tofu/counting/chain_fusion_samples.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
 """
@@ -15,7 +16,6 @@ Difference with regular chaining:
 from cupcake.tofu.counting.chain_samples import read_config, read_count_info
 
 
-#!/usr/bin/env python
 import os, sys, glob, shutil
 from csv import DictReader
 from collections import defaultdict
diff --git a/cupcake/tofu/counting/chain_samples.py b/cupcake/tofu/counting/chain_samples.py
index dd14169..1fa64dc 100644
--- a/cupcake/tofu/counting/chain_samples.py
+++ b/cupcake/tofu/counting/chain_samples.py
@@ -1,6 +1,6 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
-#!/usr/bin/env python
 import os, sys, glob, shutil
 from csv import DictReader
 from collections import defaultdict
diff --git a/cupcake/tofu/counting/scrub_sample_GFF_junctions.py b/cupcake/tofu/counting/scrub_sample_GFF_junctions.py
index 2e9d4c4..cb5efea 100644
--- a/cupcake/tofu/counting/scrub_sample_GFF_junctions.py
+++ b/cupcake/tofu/counting/scrub_sample_GFF_junctions.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
 """
diff --git a/cupcake/tofu/counting/summarize_sample_GFF_junctions.py b/cupcake/tofu/counting/summarize_sample_GFF_junctions.py
index a0373e4..3e929a4 100644
--- a/cupcake/tofu/counting/summarize_sample_GFF_junctions.py
+++ b/cupcake/tofu/counting/summarize_sample_GFF_junctions.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
 """
diff --git a/cupcake/tofu/fusion_finder.py b/cupcake/tofu/fusion_finder.py
index 421965c..cff2591 100644
--- a/cupcake/tofu/fusion_finder.py
+++ b/cupcake/tofu/fusion_finder.py
@@ -1,6 +1,6 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
-#!/usr/bin/env python
 import pdb
 import os, sys
 import itertools
diff --git a/cupcake/tofu/get_abundance_post_collapse.py b/cupcake/tofu/get_abundance_post_collapse.py
index 3198003..e007705 100644
--- a/cupcake/tofu/get_abundance_post_collapse.py
+++ b/cupcake/tofu/get_abundance_post_collapse.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
 """
diff --git a/cupcake/tofu/get_counts_by_barcode.py b/cupcake/tofu/get_counts_by_barcode.py
index 00fbb66..c1f1d41 100644
--- a/cupcake/tofu/get_counts_by_barcode.py
+++ b/cupcake/tofu/get_counts_by_barcode.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
 """
@@ -77,4 +78,4 @@ if __name__ == "__main__":
 
     args = parser.parse_args()
 
-    get_fl_count_by_barcode(args.collapse_prefix, args.classify_csv, args.cluster_csv)
\ No newline at end of file
+    get_fl_count_by_barcode(args.collapse_prefix, args.classify_csv, args.cluster_csv)
diff --git a/phasing/create_fake_genome.py b/phasing/create_fake_genome.py
index 4f1c335..52031fc 100644
--- a/phasing/create_fake_genome.py
+++ b/phasing/create_fake_genome.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
 import os, sys, re
diff --git a/phasing/run_phaser.py b/phasing/run_phaser.py
index a529a71..579119a 100644
--- a/phasing/run_phaser.py
+++ b/phasing/run_phaser.py
@@ -1,4 +1,4 @@
-
+#!/usr/bin/env python
 
 __author__ = 'etseng@pacb.com'
 
@@ -107,4 +107,4 @@ with open(args.output_prefix+'.cleaned.hap_info.txt', 'w') as f:
 
 
 new_hap.get_haplotype_vcf_assignment()
-new_hap.write_haplotype_to_vcf(args.mapping_filename, new_isoform_tally, args.output_prefix+'.cleaned')
\ No newline at end of file
+new_hap.write_haplotype_to_vcf(args.mapping_filename, new_isoform_tally, args.output_prefix+'.cleaned')
diff --git a/phasing/simulate_phasing_data_from_fasta.py b/phasing/simulate_phasing_data_from_fasta.py
index b393edd..d10c0b7 100644
--- a/phasing/simulate_phasing_data_from_fasta.py
+++ b/phasing/simulate_phasing_data_from_fasta.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
 """
diff --git a/phasing/snps_to_vcf.py b/phasing/snps_to_vcf.py
index 53153ea..bb68ece 100644
--- a/phasing/snps_to_vcf.py
+++ b/phasing/snps_to_vcf.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
 import os, sys
diff --git a/post_isoseq_cluster/demux_by_barcode_for_subsampling.py b/post_isoseq_cluster/demux_by_barcode_for_subsampling.py
index ed5c952..c8b5ff0 100644
--- a/post_isoseq_cluster/demux_by_barcode_for_subsampling.py
+++ b/post_isoseq_cluster/demux_by_barcode_for_subsampling.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__="etseng@pacb.com"
 
 import os, re, sys
@@ -77,4 +78,4 @@ if __name__ == "__main__":
 
     args = parser.parse_args()
     out_group_dict = dict(eval(args.outgroup_dict))
-    demux_for_subsamping(args.class_filename, args.fasta_filename, args.demux_count_file, args.output_prefix, out_group_dict, args.ignore_novel)
\ No newline at end of file
+    demux_for_subsamping(args.class_filename, args.fasta_filename, args.demux_count_file, args.output_prefix, out_group_dict, args.ignore_novel)
diff --git a/post_isoseq_cluster/demux_by_barcode_groups.py b/post_isoseq_cluster/demux_by_barcode_groups.py
index 8de1ac9..a10d4da 100644
--- a/post_isoseq_cluster/demux_by_barcode_groups.py
+++ b/post_isoseq_cluster/demux_by_barcode_groups.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__="etseng@pacb.com"
 
 """
diff --git a/post_isoseq_cluster/demux_isoseq2_no_genome.py b/post_isoseq_cluster/demux_isoseq2_no_genome.py
index b0030c4..9483c9c 100755
--- a/post_isoseq_cluster/demux_isoseq2_no_genome.py
+++ b/post_isoseq_cluster/demux_isoseq2_no_genome.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
 """
diff --git a/sequence/BED.py b/sequence/BED.py
index 8987088..2873121 100644
--- a/sequence/BED.py
+++ b/sequence/BED.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 import sys
 """
diff --git a/sequence/BioReaders.py b/sequence/BioReaders.py
index 4a0bb81..79cd286 100755
--- a/sequence/BioReaders.py
+++ b/sequence/BioReaders.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 """
 Should always be faithful duplicate of sequence/BioReaders.py
 Duplicated here for tofu installation. This one is called via cupcake.io.BioReaders.
diff --git a/sequence/STAR.py b/sequence/STAR.py
index cf1e503..f96d6f5 100644
--- a/sequence/STAR.py
+++ b/sequence/STAR.py
@@ -1,3 +1,5 @@
+#!/usr/bin/env python
+
 """
 Readers for STAR (spliced aligner) format reading
 """
@@ -73,4 +75,4 @@ class STARJunctionReader:
         line = self.f.readline().strip()
         if len(line) == 0:
             raise StopIteration
-        return STARJunctionRecord.process_line(line)
\ No newline at end of file
+        return STARJunctionRecord.process_line(line)
diff --git a/sequence/STARwrapper.py b/sequence/STARwrapper.py
index 1df2294..a8e3716 100644
--- a/sequence/STARwrapper.py
+++ b/sequence/STARwrapper.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 """
 Wrapper for running STARlong.
diff --git a/sequence/SeqReaders.py b/sequence/SeqReaders.py
index f8c5cca..ddd57aa 100644
--- a/sequence/SeqReaders.py
+++ b/sequence/SeqReaders.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 import os, sys
 from Bio.SeqRecord import SeqRecord
 
diff --git a/sequence/coordinate_mapper.py b/sequence/coordinate_mapper.py
index bf94bb5..7c52c2b 100644
--- a/sequence/coordinate_mapper.py
+++ b/sequence/coordinate_mapper.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 import os, sys
 import pdb
 import bisect
diff --git a/sequence/sam_to_bam.py b/sequence/sam_to_bam.py
index 07426d1..5c93c40 100644
--- a/sequence/sam_to_bam.py
+++ b/sequence/sam_to_bam.py
@@ -1,6 +1,6 @@
+#!/usr/bin/env python
 __author__ = 'etseng@pacb.com'
 
-#!/usr/bin/env python
 import os, sys
 import subprocess
 
@@ -19,4 +19,4 @@ prefix = input[:-4]
 
 run_cmd("samtools view -bS {0}.sam > {0}.bam".format(prefix))
 run_cmd("samtools sort {0}.bam > {0}.sorted.bam".format(prefix))
-run_cmd("samtools index {0}.sorted.bam".format(prefix))
\ No newline at end of file
+run_cmd("samtools index {0}.sorted.bam".format(prefix))
diff --git a/setup.py b/setup.py
index 677ad14..9a2664f 100644
--- a/setup.py
+++ b/setup.py
@@ -1,6 +1,7 @@
 from setuptools import setup, Extension, find_packages
 import sys
 import numpy as np
+from Cython.Build import cythonize
 
 
 __author__ = "etseng@pacb.com"
@@ -8,11 +9,11 @@ version = "9.0.3"
 
 ext_modules = [
                 Extension("cupcake.tofu.branch.intersection_unique",
-                    ["cupcake/tofu/branch/intersection_unique.c"]),
+                    ["cupcake/tofu/branch/intersection_unique.pyx"]),
                 Extension("cupcake.tofu.branch.c_branch",
-                         ["cupcake/tofu/branch/c_branch.c"]),
+                         ["cupcake/tofu/branch/c_branch.pyx"]),
                 Extension("cupcake.ice.find_ECE",
-                    ["cupcake/ice/find_ECE.c"]),
+                    ["cupcake/ice/find_ECE.pyx"]),
               ]
 
 
@@ -21,16 +22,24 @@ setup(
     version=version,
     author='Elizabeth Tseng',
     author_email='etseng@pacb.com',
-    ext_modules = ext_modules,
+    ext_modules = cythonize(ext_modules),
     include_dirs = [np.get_include()],
     zip_safe=False,
     packages = ['cupcake', 'cupcake.io', 'cupcake.ice',
                 'cupcake.tofu', 'cupcake.tofu.branch', 'cupcake.tofu.counting',
                 'cupcake2', 'cupcake2.io', 'cupcake2.ice2', 'cupcake2.tofu2',
                 'phasing', 'phasing.io'],
+    setup_requires=[
+        'numpy',
+        'cython'
+        ],
     install_requires=[
         'biopython',
-        'bx-python>=0.7.3'
+        'bx-python>=0.7.3',
+        'numpy',
+        'bcbiogff',
+        'sklearn',
+        'pysam'
         ],
     scripts = ['cupcake/tofu/collapse_isoforms_by_sam.py',
                'cupcake/tofu/get_abundance_post_collapse.py',
diff --git a/singlecell/UMI_BC_error_correct.py b/singlecell/UMI_BC_error_correct.py
index 155415f..c335981 100644
--- a/singlecell/UMI_BC_error_correct.py
+++ b/singlecell/UMI_BC_error_correct.py
@@ -1,4 +1,4 @@
-
+#!/usr/bin/env python
 import os, sys
 from csv import DictReader, DictWriter
 from collections import Counter, defaultdict
@@ -102,4 +102,4 @@ if __name__ == "__main__":
             print("--bc_rank_file must be given if using --only_top_ranked!", file=sys.stderr)
             sys.exit(-1)
 
-    main(args.input_csv, args.output_csv, shortread_bc, args.only_top_ranked)
\ No newline at end of file
+    main(args.input_csv, args.output_csv, shortread_bc, args.only_top_ranked)
diff --git a/singlecell/clip_out_UMI_cellBC.py b/singlecell/clip_out_UMI_cellBC.py
index 22fb270..4d5f88e 100644
--- a/singlecell/clip_out_UMI_cellBC.py
+++ b/singlecell/clip_out_UMI_cellBC.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 import os, sys
 from Bio.Seq import Seq
 from csv import DictReader, DictWriter
diff --git a/singlecell/collate_FLNC_gene_info.py b/singlecell/collate_FLNC_gene_info.py
index 0e5a40a..11fd46d 100644
--- a/singlecell/collate_FLNC_gene_info.py
+++ b/singlecell/collate_FLNC_gene_info.py
@@ -1,4 +1,4 @@
-
+#!/usr/bin/env python
 """
 Given:
 
diff --git a/singlecell/dedup_FLNC_per_cluster.py b/singlecell/dedup_FLNC_per_cluster.py
index 2c077b2..c0d5c2d 100644
--- a/singlecell/dedup_FLNC_per_cluster.py
+++ b/singlecell/dedup_FLNC_per_cluster.py
@@ -1,3 +1,4 @@
+#!/usr/bin/env python
 __author__="etseng@pacb.com"
 
 """
