{% set name = "r-saige" %}
{% set version = "0.35.8.8" %}
{% set posix = 'm2-' if win else '' %}
{% set native = 'm2w64-' if win else '' %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/weizhouUMICH/SAIGE/archive/{{ version }}.tar.gz
  sha256: f015bc9b07a47a3be46a108c9023874f667ae89562cd0b81e0a6757e7f99c563
  patches:
    # Fixing shared lib issues
    # - patches/0001-use-shared-libs-in-makevars.patch
    - patches/0358-use-shared-libs-in-makevars-0.35.8.patch
    #- patches/0002-fix-rcpp-returns.patch
    - patches/0003-fix-gettimeofday-import.patch
    - patches/0004-fix-paths-of-imported-libs-should-never-use-path.patch

build:
  skip: true  # [win]
  number: 0
  rpaths:
    - lib/R/lib/
    - lib/

requirements:
  build:
    - {{ compiler('c') }}              # [not win]
    - {{ compiler('m2w64_c') }}        # [win]
    - {{ compiler('cxx') }}            # [not win]
    - {{ compiler('m2w64_cxx') }}      # [win]
    - {{ compiler('fortran') }}        # [not win]
    - {{ compiler('m2w64_fortran') }}  # [win]
    - {{ posix }}filesystem            # [win]
    - {{ posix }}make
    - {{ posix }}sed                   # [win]
    - {{ posix }}coreutils             # [win]
    - {{ posix }}zip                   # [win]
    - r-base {{ R }}
    - savvy
    - bgenix
    - r-skat
    - r-metaskat
    - r-devtools
    - r-rcpp
    - r-rcpparmadillo
    - r-rcppparallel
    - r-matrix
    - r-data.table
    - r-rcppeigen
    - r-spatest 3.0.0
    - r-bh
    - r-optparse
    - boost
    - boost-cpp
    - superlu
  host:
    - boost
    - boost-cpp
    - liblapack
    - r-base {{ R }}
    - savvy
    - bgenix
    - superlu
    - zstd
    - zlib
    - r-skat
    - r-metaskat
    - r-devtools
    - r-rcpp
    - r-rcpparmadillo
    - r-rcppparallel
    - r-matrix
    - r-data.table
    - r-rcppeigen
    - r-spatest 3.0.0
    - r-bh
    - r-optparse
  run:
    - boost-cpp
    - liblapack
    - r-base {{ R }}
    - savvy
    - bgenix
    - sqlite
    - r-rcpp
    - r-rcppparallel
    - r-matrix
    - r-data.table
    - r-optparse

test:
  commands:
    # You can put additional test commands to be run here.
    - $R -e "library('SAIGE')"

about:
  home: https://github.com/weizhouUMICH/SAIGE
  license: GNU GPL
  license_family: GPL3
  license_file: LICENSE
  summary: Saige R package
  description: |
    SAIGE is an R package with Scalable and Accurate Implementation of Generalized
    mixed model (Chen, H. et al. 2016). It accounts for sample relatedness and is
    feasible for genetic association tests in large cohorts and biobanks (N > 400000).
  dev_url: https://github.com/weizhouUMICH/SAIGE

extra:
  recipe-maintainers:
    - matuskosut
