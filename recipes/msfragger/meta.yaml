{% set version = "3.5" %}

package:
  name: msfragger
  version: {{ version }}

build:
  number: 0
  skip: True  # [osx]
  # noarch: generic
  script:
    - if [ -z "$NAME" ]; then export NAME=${USERNAME:-bioconda}; fi
    - if [ -z "$EMAIL" ]; then export EMAIL=${NAME}@${HOSTNAME:-bioconda.org}; fi
    - if [ -z "$INSTITUTION" ]; then export INSTITUTION=${HOSTNAME:-bioconda.org}; fi
    - mkdir -p $PREFIX/bin
    - cp $RECIPE_DIR/msfragger.py $PREFIX/bin/
    - ln -s $PREFIX/bin/msfragger.py $PREFIX/bin/msfragger
    - chmod 0755 "${PREFIX}/bin/msfragger"
    - echo ${RECIPE_DIR}/academic_install.py -n galaxy -e "$EMAIL" -o "$INSTITUTION" -m '3.5' -p ${PREFIX}/bin
    - ${RECIPE_DIR}/academic_install.py -n galaxy -e "$EMAIL" -o "$INSTITUTION" -m '3.5' -p ${PREFIX}/bin
    - cd $PREFIX/bin
    - unzip $PREFIX/bin/MSFragger-$PKG_VERSION.zip
    - ln -s $PREFIX/bin/MSFragger-$PKG_VERSION/MSFragger-$PKG_VERSION.jar $PREFIX/bin/MSFragger.jar

requirements:
  host:
  run:
    - openjdk >=11
    - python >=3.9
    - mono >=5, <6
    - zlib

test:
  commands:
    - msfragger -Xms512m -Xmx1g --help  2>&1 | grep 'MSFragger'

about:
  home: https://github.com/Nesvilab/MSFragger
  license: ACADEMIC
  summary: |
    MSFragger is an ultrafast database search tool for peptide identification in mass spectrometry-based proteomics.
    It has demonstrated excellent performance across a wide range of datasets and applications.
    MSFragger is suitable for standard shotgun proteomics analyses as well as large datasets (including timsTOF PASEF data),
    enzyme unconstrained searches (e.g., peptidome),
    open database searches (e.g., precursor mass tolerance set to hundreds of Daltons) for identification
    of modified peptides, and glycopeptide identification (N-linked and O-linked).

    MSFragger is available freely for academic research and educational purposes only.
    http://msfragger-upgrader.nesvilab.org/upgrader/MSFragger-LICENSE.pdf
    This license provides with non-exclusive, non-transferable right to use MSFragger solely for academic research, non-commercial or educational purposes.

    I agree to be subject to the terms and conditions of this license.
    I understand that to use MSFragger for other purposes requires a commercial license from the University of Michigan Office of Tech Transfer.

    I agree to the terms of Thermo (c) Raw File Reader License Agreement.
    http://msfragger-upgrader.nesvilab.org/upgrader/RawFileRdr_License_Agreement_RevA.pdf

    I agree to the terms of Bruker SDK library distribution conditions.
    http://msfragger-upgrader.nesvilab.org/upgrader/redist.txt

extra:
  notes: |
    MsFragger is a Java program.
  identifiers:
    - doi:10.1038/nmeth.4256
    - doi:10.1038/s41467-020-17921-y
    - doi:10.1038/s41592-020-0967-9
