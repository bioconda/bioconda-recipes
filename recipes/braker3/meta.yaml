{% set name = "BRAKER3" %}
{% set version = "3.0.3" %}
{% set sha256 = "3cb65c3bc51abc2a5217927c04a65739062e59c54e938504520993a193a671b4" %}

package:
  name: "{{ name|lower }}"
  version: "{{ version }}"

source:
- url: https://github.com/Gaius-Augustus/BRAKER/archive/v{{ version }}.tar.gz
  sha256: {{ sha256 }}
  patches:
    - braker.pl.patch
- url: https://raw.githubusercontent.com/Gaius-Augustus/GUSHR/ee26d5c7eee97170c6183089d57477b338a7bc4b/gushr.py
  sha256: 28f1faff34a75b0bea79510fddc8eddf2ba0d0aca18030c5af252364bf708eab
  patches:
    - gushr.py.patch
- url: https://github.com/Gaius-Augustus/TSEBRA/archive/refs/tags/v1.0.1.tar.gz
  sha256: afe4c008d964d3554e1e6804e8330cd392d4daa38f1aa0a2739c1e8fbd6278fc
  folder: tsebra

build:
  number: 0
  noarch: generic

requirements:
  run:
    - python >=3.3
    - biopython
    - gemoma ==1.6.4
    - perl
    - perl-app-cpanminus
    - perl-hash-merge
    - perl-parallel-forkmanager
    - perl-scalar-util-numeric
    - perl-yaml
    - perl-class-data-inheritable
    - perl-exception-class
    - perl-test-pod
    - perl-file-homedir
    - perl-file-which
    - perl-file-spec
    - perl-list-moreutils
    - perl-logger-simple
    - perl-math-utils
    - perl-module-load-conditional
    - perl-posix
    - perl-mce
    - augustus >=3.5.0
    - bamtools >=2.5.1
    - samtools >=1.7
    - spaln >=2.3.3
    - exonerate >=2.2.0  # Can be used by braker2, but deprecated in favour of genomethreader
    - blast >=2.2.31  # Can be used by braker2, but deprecated in favour of diamond
    - makehub
    - cdbtools >=0.99
    - genomethreader >=1.7.0
    - diamond >=0.9.24
      #    - genemark-et >=4.48
      #    - prothint >=2.2.0
    - stringtie >=2.2.1
    - bedtools
    - gffread

test:
  commands:
    - braker.pl
    - downsample_traingenes.pl 2>&1 | grep "downsample_traingenes.pl" > /dev/null
    - filterGenemark.pl
    - filterIntronsFindStrand.pl
    - findGenesInIntrons.pl 2>&1 | grep "findGenesInIntrons.pl" > /dev/null
    - startAlign.pl
    - "gushr.py -h | grep -q 'usage: gushr.py'"
    - "fix_gtf_ids.py -h | grep -q usage:"
    - "tsebra.py -h | grep -q usage:"

about:
  home: https://github.com/Gaius-Augustus/BRAKER
  license: Artistic License
  license_family: Other
  license_file: LICENSE.TXT
  summary: "BRAKER3 is an extension of BRAKER2"
  description: "BRAKER3 is the latest pipeline in the BRAKER suite. It enables the usage of RNA-seq and protein data in a fully automated pipeline to train and predict highly reliable genes with GeneMark-ETP and AUGUSTUS. ."

extra:
  identifiers:
    - doi:10.1093/nargab/lqaa108
  notes:
    - GeneMark software can be used for free, but requires a license file and should be additionally installed on the machine where the BRAKER3 environment is.
    - ProtHint software can be used for free, but doesn't allow redistribution and should be additionally installed on the machine where the BRAKER3 environment is.
