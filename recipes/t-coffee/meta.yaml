{% set name = "t-coffee" %}
{% set version = "13.46.2.7c9e712d" %}

package:
  name: {{ name }}
  version: {{ version }}

build:
  number: 0
  run_exports:
    - {{ pin_subpackage(name, max_pin="x") }}

source:
  # The latest stable release is at http://www.tcoffee.org/Packages/Stable/Latest/,
  # but is then archived at http://www.tcoffee.org/Packages/Archives/
  url: https://s3.eu-central-1.amazonaws.com/tcoffee-packages/Archives/T-COFFEE_distribution_Version_{{ version }}.tar.gz
  sha256: 84f9b4076767d39dec6619c5eb91c9538a7c58c68a3731a92ebbf2e1f914296f
  patches:
    - expose-os-detection.patch
    - coredump.patch

requirements:
  build:
    - make
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - {{ compiler('fortran') }}
    - pkg-config
  host:
    - perl            ==5.32.*
    - perl-xml-simple
    - wget
  run:
    - perl            ==5.32.*
    - clustalo        ==1.2.4
    - clustalw        ==2.1
    - consan          ==1.2
    - dialign-tx      >=1.0.2
    - famsa           ==2.2.3
    - kalign2         ==2.04
    - mafft           ==7.526
    - muscle          ==3.8.1551
    - mustang         >=3.2.3
    - pasta           ==1.9.2
    - phylip          ==3.697
    - poa             >=2.0
    - prank           ==170427
    - probcons        ==1.12
    - probconsrna     ==1.10
    - proda           ==1.0
    - sap             ==1.1.3
    # Do not update tmalign newer versions cause error
    - tmalign         ==20170708  # [not arm64]
    - viennarna       ==2.7.0

test:
  commands:
    - test -x ${PREFIX}/bin/t_coffee  # [osx]
    - HOME="/tmp" t_coffee -version  # [not osx]
    #Â what does the package think it has installed:
    - HOME="/tmp" t_coffee  # [not osx]
    # These messages don't end up getting compiled in correctly under OSX
    - HOME="/tmp" t_coffee 2>&1 | grep "kalign is  Installed"  # [not osx]
    - HOME="/tmp" t_coffee 2>&1 | grep "mafft is  Installed"  # [not osx]
    - HOME="/tmp" t_coffee 2>&1 | grep "probcons is  Installed"  # [not osx]
    - HOME="/tmp" t_coffee 2>&1 | grep "probconsRNA is  Installed"  # [not osx]
    - HOME="/tmp" t_coffee 2>&1 | grep "sap is  Installed"  # [not osx]

about:
  home: "https://github.com/cbcrg/tcoffee"
  license: "GPL-2.0-only"
  license_family: GPL
  license_file: "license.txt"
  summary: "A collection of tools for Multiple Alignments of DNA, RNA, Protein Sequence."
  dev_url: "https://github.com/cbcrg/tcoffee"
  doc_url: "https://tcoffee.org/Projects/tcoffee/documentation/index.html"

extra:
  additional-platforms:
    - linux-aarch64
    - osx-arm64
  identifiers:
    - doi:10.1006/jmbi.2000.4042
    - usegalaxy-eu:t_coffee
    - biotools:tcoffee
