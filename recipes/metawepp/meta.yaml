{% set name = "metawepp" %}
{% set version = "0.1.1" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  #url: https://github.com/TurakhiaLab/metaWEPP/releases/download/v{{ version }}/{{ name }}-{{ version }}.tar.gz
  #sha256: 81a9f40d0c795300c443655ba3502903f6060ad789f5d1a797cd71492db52d12
  git_url: https://github.com/TurakhiaLab/metaWEPP.git
  git_rev: main

build:
  number: 1
  #run_exports:
  #  - {{ pin_subpackage("metawepp", max_pin="x.x") }}

requirements:
  build:
    - {{ compiler('cxx') }}
    - nodejs
    - git

  host:
    - pip
    - boost-cpp =1.78.0
    - tbb >=2021.0
    - tbb-devel 
    - protobuf <4
    - nodejs
    - mpich
    - jsoncpp

  run:
    - python =3.11
    - pip
    - kraken2 >=2.1.0
    - mpich
    - jsoncpp
    - boost =1.78.0
    - protobuf <4
    - tbb >=2021.0
    - snakemake-minimal >=8.0
    - pandas
    - altair
    - aiohttp
    - biopython
    - matplotlib
    - pigz
    - minimap2
    - docker-py
    - wepp

test:
  commands:
    - run-metawepp help --cores 1
    - rm -rf .snakemake

about:
  home: "https://github.com/TurakhiaLab/metaWEPP"
  license: MIT
  license_family: MIT
  license_file: LICENSE
  summary: "metaWEPP: Improving resolution of metagenomic analysis using WEPP"
  description:
    metaWEPP extends the current species-level resolution of existing metagenomic tools by providing near-haplotype detection and abundance estimation for multi-species samples. It utilizes a standard classifier to first segregate reads by species before applying the Wastewater-Based Epidemiology using Phylogenetic Placements (WEPP) pipeline to each segregated dataset. By performing parsimonious read placement on species-specific mutation-annotated trees (MATs), metaWEPP identifies the haplotypes that best explain the data and flags Unaccounted Alleles—mutations observed in the sample but unexplained by selected haplotypes—potentially indicating the presence of novel variants.

    The pipeline enables high-resolution surveillance across diverse pathogens and includes an interactive dashboard for visualizing identified haplotypes within their global phylogenies. This allows for detailed, read-level analysis of emerging lineages within complex metagenomic datasets.

  #doc_url: "https://turakhia.ucsd.edu/metaWEPP"

extra:
  recipe-maintainers:
    - pgangwar-ucsd
