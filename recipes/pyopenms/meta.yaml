{% set name = "pyopenms" %}
{% set version = "3.4.1" %}  # if ends with 'dev' it is considered a development release and pulled from GitHub

package:
  name: {{ name }}
  version: {{ version }}
{% if "dev" in version %}

source:
  git_url: https://github.com/OpenMS/OpenMS.git
  git_rev: develop
  md5: unused
{% else %}

source:
  url: https://github.com/OpenMS/OpenMS/releases/download/release%2F{{ version }}/OpenMS-{{ version }}.tar.gz
  md5: 8d0b4d1d333f069959f7d5ff1c77a90f
{% endif %}

build:
  number: 2
  skip: True  # [py < 310]
  run_exports:
    - {{ pin_subpackage(name, max_pin="x") }}

requirements:
  build:
    - {{ compiler('cxx') }}
    - ninja
    - cmake
  host:
    - python
    - pip
    - cython <3.1
    - libopenms =={{ version }}
    - autowrap >=0.22.11,<0.23
    - libboost-headers  # autowrap depends on boost for shared_ptr (if not explicitly disabled by our build scripts, or if we allow it to use autowraps own copy of boost headers) see https://github.com/OpenMS/OpenMS/issues/8184
    - numpy >=2.0
    - pandas
    - matplotlib-base
    - pytest
    - eigen >=3.4.0  # from libopenms. since eigen is header-only, it does not have a run-export. but libopenms exposes it broadly in the public interface.
    # We should probably make it a mandatory run dependency of libopenms then. Conda does not complain about "underspecifying dependencies" because it is header-only.
    # If we add it there, we probably should ignore the resulting overlinking warnings.
  run:
    - python
    - libopenms =={{ version }}
    - numpy >=2.0
    - pandas
    - matplotlib-base

test:
  commands:
    - python -c "import pyopenms; print(pyopenms.__version__)"
    # We cant use the PYTHON variable since it does not exist on the biocontainer?!
    # TODO run the full test suite?

about:
  home: "https://github.com/OpenMS/OpenMS"
  license: "BSD-3-Clause"
  license_family: BSD
  license_file: LICENSE
  summary: "Python bindings for OpenMS, an open-source software C++ library for LC-MS data management and analyses."
  dev_url: "https://github.com/OpenMS/OpenMS"
  doc_url: "https://openms.readthedocs.io/en/latest"

extra:
  additional-platforms:
    - linux-aarch64
    - osx-arm64
{% if "dev" in version %}
  skip-lints:
    - uses_vcs_url
{% endif %}
  identifiers:
    - biotools:openms
    - doi:10.1038/s41592-024-02197-7
