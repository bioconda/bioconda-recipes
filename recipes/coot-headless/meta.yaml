{% set name = "coot-headless" %}
{% set version = "Release-1.1.20" %}

package:
  name: {{ name }}
  version: {{ version.split('-')[1] }}

source:
  url: https://github.com/pemsley/coot/archive/refs/tags/{{ version }}.tar.gz
  sha256: 3bac75e3aaa7991ff2c24539cc594f1e1c205fe1bd7aa256e4f4d13120fdd04f

build:
  number: 1
  run_exports:
    # Minor version changes may be disruptive
    # Refer to https://github.com/pemsley/coot/issues/239#issuecomment-3031606299
    - {{ pin_subpackage(name, max_pin="x.x.x") }}

requirements:
  build:
    - {{ compiler("c") }}
    - {{ compiler("cxx") }}
    - cmake
    - doxygen
    - ghostscript  # [osx and x86_64]
    - ninja
    - pkg-config
    - sed  # [osx]
    - texlive-core
  host:
    - cairo
    - clipper
    - curl
    - eigen
    - elfutils  # [linux]
    - fontconfig
    - freetype
    - gemmi
    - glm
    - gsl
    - libboost-devel >=1.86,<1.87
    - libccp4
    - libffi
    - libintl-devel  # [osx]
    - libpng
    - librdkit-dev
    - libxml2
    - mmdb2
    - nanobind
    - numpy {{ numpy }}
    - openblas
    - pixman
    - python {{ python }}
    - sqlite
    - ssm
    - typing_extensions  # [py < 311]
    - zlib
  run:
    - numpy {{ numpy }}
    - python {{ python }}
    - rdkit
    - servalcat

test:
  imports:
    - coot_headless_api
  source_files:
    - data/tutorial-modern.pdb
    - data/rnasa-1.8-all_refmac1.mtz

about:
  home: "https://www2.mrc-lmb.cam.ac.uk/personal/pemsley/coot"
  dev_url: "https://github.com/pemsley/coot"
  doc_url: "https://www.mrc-lmb.cam.ac.uk/lucrezia/libcootapi-documentation/index.html"
  license: "GPL-3.0-or-later AND LGPL-3.0-or-later"
  license_family: GPL3
  license_file:
    - COPYING
    - COPYING.LESSERv3
  summary: "Coot Headless API - Software for macromolecular model building."
  description: |
    Coot is a macromolecular model building, model completion and validation
    application. This package provides the headless APIs (Chapi python bindings and libcootapi C++ library)
    without GUI dependencies, suitable for automated workflows.

extra:
  additional-platforms:
    - linux-aarch64
    - osx-arm64
  identifiers:
    - doi:10.1107/S0907444910007493
  recipe-maintainers:
    - eunos-1128
