{% set name = "metabat2" %}
{% set version = "2.18" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
- url: https://bitbucket.org/berkeleylab/metabat/get/v{{ version }}.tar.bz2  # [linux]
  sha256: 7decee72535c75c390e8ddfb84e2e4d23bab9a4c2c85438e2270b19a7f3e568a  # [linux]
  patches:  # [linux]
    - cmake.patch  # [linux]
    - cmake-htslib.patch  # [linux and aarch64]
- url: https://bitbucket.org/berkeleylab/metabat/get/cdb66e9c2fab2cf11ee156ad2e7d7690fb7c8a26.tar.bz2  # [osx]
  sha256: 7f09be5dbff4ccf046088e967f68252a521b9c7372eb6cd8566925da6e8d4440  # [osx]
  patches:  # [osx]
    - cmake.patch  # [osx]

build:
  number: 1
  run_exports:
    - {{ pin_subpackage(name, max_pin="x") }}

requirements:
  build:
    - {{ compiler('cxx') }}
    - {{ compiler('c') }}
    - cmake
    - make
    - autoconf
    - automake
    - libtool
    - pkg-config
  host:
    - zlib
    - htslib
    - boost-cpp
    - libdeflate
    - llvm-openmp  # [osx]
    - libgomp      # [linux]
  run:
    - perl
    - boost-cpp
    - llvm-openmp  # [osx]
    - libgomp      # [linux]

test:
  commands:
    - metabat2 -h
    - metabat1 -h
    - jgi_summarize_bam_contig_depths -h
    - contigOverlaps -h

about:
  home: "https://bitbucket.org/berkeleylab/metabat"
  license: "BSD-3-Clause-LBNL"
  license_family: BSD
  license_file: "license.txt"
  summary: "Metagenome binning."
  dev_url: "https://bitbucket.org/berkeleylab/metabat"
  doc_url: "https://bitbucket.org/berkeleylab/metabat/src/v{{ version }}/README.md"

extra:
  additional-platforms:
    - linux-aarch64
    - osx-arm64
  identifiers:
    - doi:10.7717/peerj.1165
    - biotools:MetaBAT_2
    - usegalaxy-eu:metabat2
