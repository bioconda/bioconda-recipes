{% set name = "gargammel" %}
{% set version = "1.1.4" %}
{% set sha256_gargammel = "620631e18ee2b4094a154a85cbd2fba9a5771c04daa028d7d1401f8a115a2963" %}
{% set sha256_libgab = "2cadc9dedccbd19f274585b830ecc3ecde635a001e7ddd7f88ba9fe8e3a537e3" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  - url: https://github.com/grenaud/libgab/archive/304eeb83444201b4b5557e954ee6c7ffa367adc0.tar.gz
    sha256: {{ sha256_libgab }}
    folder: gargammel/libgab
  - url: https://github.com/grenaud/gargammel/archive/refs/tags/{{ version }}.tar.gz
    sha256: {{ sha256_gargammel }}
    folder: gargammel
    patches:
      - 0001-gargammel-Makefile-nobamtools.patch
      - 0002-libgab-Makefile-removed-CXX.patch

build:
  number: 0
  run_exports:
    - {{ pin_subpackage('gargammel', max_pin="x") }}

requirements:
  build:
    - make
    - {{ compiler('cxx') }}
    - pkg-config
  host:
    - gsl
    - zlib
    - bamtools ==2.5.3
  run:
    - openssl
    - perl
    - gsl
    - art
    - samtools

test:
  commands:
    - gargammel --help
    - adptSim --help | grep -q 'adptSim'
    - deamSim --help | grep -q 'deamSim'
    - fasta2fastas --help | grep -q 'fasta2fastas'
    - fragSim --help | grep -q 'fragSim'

about:
  home: "https://github.com/grenaud/gargammel"
  license: "GPL-3.0-only"
  license_family: GPL3
  license_file: "gargammel/LICENSE"
  summary: "Tool for simulating ancient DNA datasets."
  description: |
    gargammel is a set of programs aimed at simulating ancient DNA
    fragments. For ancient hominin samples our program can also 
    simulate various levels of present-day human contamination and 
    microbial contamination.
  dev_url: "https://github.com/grenaud/gargammel"

extra:
  additional-platforms:
    - linux-aarch64
    - osx-arm64
