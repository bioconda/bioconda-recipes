{% set version = "1.0.0" %}

package:
  name: hymet
  version: {{ version }}

build:
  number: 0
  noarch: generic  # Mudado de 'python' para 'generic' (pois não é só Python)
  script: |
    # Instala dependências Python
    {{ PYTHON }} -m pip install pandas numpy biopython tqdm
    
    # Cria estrutura de diretórios
    mkdir -p $PREFIX/bin $PREFIX/lib/hymet/scripts
    
    # Copia arquivos principais
    cp *.pl $PREFIX/bin/
    cp scripts/*.{py,sh} $PREFIX/lib/hymet/scripts/
    
    # Dá permissões
    chmod +x $PREFIX/bin/*.pl
    chmod +x $PREFIX/lib/hymet/scripts/*.{sh,py}
    
    # Cria um wrapper Python (opcional)
    cat > $PREFIX/bin/hymet << 'EOF'
    #!/usr/bin/env python3
    import subprocess
    import sys
    from pathlib import Path
    
    def run():
        if len(sys.argv) > 1:
            subprocess.run([str(Path(__file__).parent / "main.pl"] + sys.argv[1:])
        else:
            print("Use: hymet [comando]")
    
    if __name__ == "__main__":
        run()
    EOF
    chmod +x $PREFIX/bin/hymet
  skip: False

source:
  url: https://github.com/inesbmartins02/HYMET/archive/refs/tags/v{{ version }}.tar.gz
  sha256: b4985691ab6f813bc919449a9d6bcb05ef02980bca05260cd3c3418530a927b7

requirements:
  host:
    - python >=3.8
    - pip
    - perl
  run:
    - python >=3.8
    - perl
    - mash
    - minimap2
    - pandas
    - numpy
    - biopython
    - csvkit
    - wget
    - tqdm

test:
  commands:
    - hymet --help  # Testa se o wrapper funciona
    - perl $PREFIX/bin/main.pl --version  # Testa o script Perl

about:
  home: https://github.com/inesbmartins02/HYMET
  license: GPL-3.0-only
  license_file: LICENSE  
  summary: "Hybrid Metagenomic Tool for advanced sequence analysis"
  doc_url: https://github.com/inesbmartins02/HYMET/blob/main/README.md
  dev_url: https://github.com/inesbmartins02/HYMET

extra:
  recipe-maintainers:
    - inesbmartins02