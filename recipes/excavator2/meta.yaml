{% set name = "excavator2" %}
{% set version = "1.0.2" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

build:
  number: 0
  run_exports:
    - {{ pin_subpackage(name, max_pin="x.x") }}

source:
  url: https://github.com/ctglab/{{ name }}/archive/refs/tags/v{{ version }}.tar.gz
  sha256: f9c7f3f0f0374243f26cd9c5dde01c321566dd6006599b5d5f25265240c967d1

requirements:
  build:
    - {{ compiler('fortran') }}
    - {{ compiler('cxx') }}
    - make
    - llvm-openmp  # [osx]

  host:
    - r-base

  run:
    - perl
    - perl-yaml-tiny
    - python
    - r-base
    - bedtools
    - samtools
    - ucsc-bigwigaverageoverbed
    - pyyaml
    - argcomplete
    - r-argparse
    - r-ggplot2
    - bioconductor-complexheatmap
    - bioconductor-genomicranges
    - bioconductor-iranges
    - r-getoptlong
    - zlib
    - bzip2
    - xz
    - libcurl

test:
  commands:
    # Test binaries are in PATH
    - TargetPerla.pl 2>&1 | cat > /dev/null
    - EXCAVATORDataAnalysis.pl 2>&1 | grep "Usage" || true

    # Test compiled Fortran shared library
    - |
      Rscript -e "
      bin_path <- Sys.which('TargetPerla.pl');
      install_root <- dirname(dirname(bin_path));
      so_path <- file.path(
        install_root, 'share', 'excavator2', 'lib', 'F77', 'F4R.so'
      );
      cat('Loading:', so_path, '\n');
      if (!file.exists(so_path)) quit(status = 1);
      dyn.load(so_path)
      "

about:
  home: https://github.com/ctglab/excavator2
  summary: >
    EXCAVATOR2 is the first read-count-based tool that exploits all the reads
    produced by WES experiments to detect CNVs with a genome-wide resolution.
  license: CC-BY-NC-SA-3.0
  license_family: CC
  license_file: LICENSE.txt
  dev_url: https://github.com/ctglab/excavator2
  doc_url: https://github.com/ctglab/excavator2/v{{ version }}/README.md

