{% set version = "3.0.3" %}
{% set vdb_version = "3.0.2" %}


package:
  name: sranew
  version: '{{ version }}'

source:
  - url: https://github.com/ncbi/sra-tools/archive/{{version}}.tar.gz
    sha256: ea4b9a4b2e6e40e6b2bf36b01eb8df2b50280ef9dcdc66b504c1d1296600afbd
    folder: sra-tools
  - url: https://github.com/ncbi/ncbi-vdb/archive/{{vdb_version}}.tar.gz
    sha256: 275ccb225ddb156688c8c71f772f73276cb18ebff773a51150f86f8002ed2d59
    folder: ncbi-vdb

build:
  number: 0

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - make
    - cmake
    - flex
    - bison
  host:
    #- ncbi-ngs-sdk
    #- ncbi-vdb=3.0.0
    - libxml2
    - zlib>=1.2.13
    - bzip2
    - hdf5
    - perl
  run:
    - ca-certificates
    - ossuuid
    - perl
    #- ncbi-ngs-sdk
    #- ncbi-vdb=3.0.0
    - perl-xml-libxml
    - perl-uri
    - curl

test:
  commands:
    # create config file with /LIBS/GUID value so tests pass; new GUID value will be created in user's home dir upon installation via post-link.sh
    - if ! grep "/LIBS/GUID" ~/.ncbi/user-settings.mkfg &> /dev/null; then mkdir -p ~/.ncbi && printf '/LIBS/GUID = "%s"\n' `uuid` > ~/.ncbi/user-settings.mkfg; fi
    - fastq-dump --help > /dev/null
    - prefetch --help > /dev/null
    - sam-dump --help > /dev/null
    - sra-pileup --help > /dev/null
    - vdb-config --help > /dev/null
    - vdb-decrypt --help > /dev/null
    - fastq-dump -N 1 -X 1 SRR000001 && grep '@SRR000001.1' SRR000001.fastq
    - fasterq-dump --help > /dev/null

about:
  home: https://github.com/ncbi/sra-tools
  license: Public Domain
  summary: SRA Toolkit and SDK from NCBI
  description:  |
    The SRA Toolkit and SDK from NCBI is a collection of tools and libraries
    for using data in the INSDC Sequence Read Archives.

extra:
  notes: 'After installation, you should run the configuration tool: ./vdb-config
    -i. This tool will setup your download/cache area for downloaded files and references.'
