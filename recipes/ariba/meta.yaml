{% set name = "ariba" %}
{% set version = "2.14.7" %}
{% set sha256 = "98d78ee20aa4099fdce5c4ebd5390d914a7a4fe78eac381d5c7c0c6fecaaddfb" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  url: https://github.com/sanger-pathogens/ariba/archive/v{{ version }}.tar.gz
  sha256: {{ sha256 }}

build:
  number: 0
  script:
    - sed -i.bak "s|2.14.6|${PKG_VERSION}|" setup.py
    - sed -i.bak 's|find_packages|find_namespace_packages|' setup.py
    - rm -f *.bak
    - {{ PYTHON }} -m pip install . -vvv --no-deps --no-build-isolation --no-cache-dir --use-pep517
  run_exports:
    - {{ pin_subpackage(name, max_pin="x") }}

requirements:
  build:
    - {{ compiler("c") }}
    - {{ compiler("cxx") }}
    - pkg-config
  host:
    - python
    - pip
    - zlib
  run:
    - python
    - setuptools
    - beautifulsoup4 >=4.1.0
    - dendropy >=4.2.0
    - matplotlib-base >=3.1.0
    - biopython
    - pyfastaq >=3.12.0
    - pysam >=0.21.0
    - pymummer >=0.11.0
    - bowtie2
    - cd-hit >=4.6.5
    - samtools >=1.2
    - bcftools >=1.2
    - mummer >=3.23
    - spades >=3.5.0
    - wget

test:
  imports:
    - ariba
    - ariba.tasks
  commands:
    - "ariba version"

about:
  home: "https://github.com/sanger-pathogens/ariba"
  license: "GPL-3.0-or-later"
  license_family: GPL3
  license_file: LICENSE
  summary: "ARIBA: Antibiotic Resistance Identification By Assembly."
  dev_url: "https://github.com/sanger-pathogens/ariba"
  doc_url: "https://sanger-pathogens.github.io/ariba"

extra:
  container:
    # matplotlib depends on libGL.so.1 from the system
    extended-base: True
