{% set version = "1.3.0" %}

package:
  name: metawrap-mg
  version: {{ version }}

source:
  # self-reports as 1.3.0, but tag is v1.3
  url: https://github.com/bxlab/metaWRAP/archive/v1.3.tar.gz
  sha256: ffdbccf340dc0b1ebd0ad6f222e3bdef1e22bbd6e4e5156bf93500a3a834dd52

build:
  noarch: generic
  number: 3
  run_exports:
     - {{ pin_subpackage('metawrap-mg', max_pin="x.x") }}

requirements:
  run:
    - biopython =1.72
    # - blast =2.6.0
    # - bmtagger =3.101
    # - bowtie2 =2.3.5
    # - bwa =0.7.17
    # - fastqc =0.11.8
    # - kraken2 =2.0
    # - matplotlib-base =2.2.3
    # - megahit =1.1.3
    # - openssl =1.0
    # - pandas =0.24.2
    # - perl-bioperl
    # - pplacer =1.1.alpha19
    # - prokka =1
    # - quast =5.0.2
    # - r-ggplot2 =3.1.0
    # - r-reshape2
    # - r-recommended =3.5.1
    # - salmon =0.13.1
    # - samtools =1.9
    # - seaborn =0.9.0
    # - spades =3.13.0
    # - taxator-tk =1.3.3e
    # - trim-galore =0.5.0
    # not direct dependencies, only here to speed up dependency resolution
    - python =2.7.15

test:
  commands:
    - "metawrap --version | grep 'metaWRAP v={{ version }}'"
    - "metawrap read_qc | grep 'Usage: metaWRAP read_qc'"
    - which config-metawrap
    - python2.7

outputs:
  - name: metawrap-mg-binning
    version: {{ version }}

    requirements:
      run:
        - blas =2.5 mkl
        - concoct =1.0.0
        - maxbin2 =2.2.6
        - metabat2 =2.12.1

    # build:
    #   run_exports:
    #       -  metawrap-mg-binning {{ version }}

    test:
      # Test copied from openms output to make sure a test environment for this output is created.
      commands:
        - "metawrap binning | grep 'Usage: metaWRAP binning'"

    about:
      home: https://github.com/bxlab/metaWRAP
      license: MIT
      summary: "MetaWRAP requirements for binning step"

  - name: metawrap-mg-refinement
    version: {{ version }}

    requirements:
      run:
        - checkm-genome =1.0.12
        - kraken =1.1.1
        - krona =2.7

    # build:
    #   run_exports:
    #       -  metawrap-mg-refinement {{ version }}

    test:
      # Test copied from openms output to make sure a test environment for this output is created.
      commands:
        - "metawrap bin_refinement | grep 'Usage: metaWRAP bin_refinement'"

    about:
      home: https://github.com/bxlab/metaWRAP
      license: MIT
      summary: "MetaWRAP requirements for bin_refinement step"

about:
  home: https://github.com/bxlab/metaWRAP
  license: MIT
  summary: "MetaWRAP is a pipeline for genome-resolved metagenomic data analysis"
