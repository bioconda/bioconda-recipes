{% set name = "igblast" %}
{% set version = "1.22.0" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  - url: ftp://ftp.ncbi.nih.gov/blast/executables/igblast/release/{{ version }}/ncbi-igblast-{{ version }}-src.tar.gz  # [linux or (osx and arm64)]
    sha256: a04eb195087447cf42e673401ae2d9f6ef8414b34f1534724a6953f41224df68  # [linux or (osx and arm64)]
  - url: ftp://ftp.ncbi.nih.gov/blast/executables/igblast/release/{{ version }}/ncbi-igblast-{{ version }}-x64-macosx.tar.gz  # [osx and x86_64]
    sha256: b8a0034642b5dbef7f41c7fcfbb4bc035d2c5877d3e987af43605ea8e3d55c40  # [osx and x86_64]
patches:
    - shared_vdb.patch  # [linux]

build:
  number: 2
  run_exports:
  - {{ pin_subpackage('igblast', max_pin="x") }}

requirements:
  build:
    - make
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - gnuconfig
  host:
    - zlib
    - bzip2
    - libidn11  # [not arm64]
    - libgomp  # [linux]
    - sqlite >=3
    - ncbi-vdb
    - wget
  run:
    - ncbi-vdb
    - perl
    - libgomp  # [linux]

test:
  commands:
    - igblastn -h
    - igblastp -h
    - makeblastdb -h

about:
  home: "https://www.ncbi.nlm.nih.gov/projects/igblast"
  license: "Public Domain and Others"
  license_file:
    - c++/include/misc/jsonwrapp/rapidjson11/license.txt  # [linux]
    - c++/include/util/bitset/license.txt                 # [linux]
    - c++/scripts/projects/blast/LICENSE                  # [linux]
    - c++/scripts/projects/igblast/LICENSE                # [linux]
    - c++/src/util/compress/bzip2/LICENSE                 # [linux]
    - c++/src/util/lmdb/LICENSE                           # [linux]
    - c++/src/util/lmdbxx/UNLICENSE                       # [linux]
    - LICENSE                                             # [osx]
  summary: "A tool for analyzing immunoglobulin (IG) and T cell receptor (TR) sequences."
  doc_url: "https://ncbi.github.io/igblast"

extra:
  additional-platforms:
    - linux-aarch64
    - osx-arm64
  identifiers:
    - biotools:igblast
