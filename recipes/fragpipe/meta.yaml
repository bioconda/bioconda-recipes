{% set name = "FragPipe" %}
{% set version = "18.0" %}

package:
  name: fragpipe
  version: {{ version }}

build:
  number: 0
  noarch: generic

source:
  url: https://github.com/Nesvilab/{{ name }}/releases/download/{{ version }}/{{ name }}-{{ version }}.zip
  sha256: 571577d19840c46064b9ccf14f45bfc30757a024477aa925945faae1e38a2174

build:
  number: 0
  script:
    - if [ -z "$NAME" ]; then export NAME=${USERNAME:-bioconda}; fi
    - if [ -z "$EMAIL" ]; then export EMAIL=${NAME}@${HOSTNAME:-bioconda.org}; fi
    - if [ -z "$INSTITUTION" ]; then export INSTITUTION=${HOSTNAME:-bioconda.org}; fi
    - mkdir -p $PREFIX/
    - cp  -rp * $PREFIX/
    - chmod -x $PREFIX/bin/fragpipe
    - cp ${RECIPE_DIR}/fragpipe_cli $PREFIX/bin
    - echo ${RECIPE_DIR}/academic_install.py -n galaxy -e "$EMAIL" -o "$INSTITUTION" -i '1.8.0' -p ${PREFIX}/tools
    - ${RECIPE_DIR}/academic_install.py -n galaxy -e "$EMAIL" -o "$INSTITUTION" -i '1.8.0' -p ${PREFIX}/tools
  missing_dso_whitelist:
    - /lib64/libgomp.so.1
    - /lib64/libdl.so.2
    - /lib64/librt.so.1
    - /lib64/libpthread.so.0
    - /lib64/libm.so.6
    - /lib64/libc.so.6
    - /lib64/ld-linux-x86-64.so.2
    - /lib64/libdl.so.2
    - /lib64/librt.so.1
    - /lib64/libm.so.6
    - /lib64/libpthread.so.0
    - /lib64/libstdc++.so.6
    - /lib64/libgcc_s.so.1
    - /lib64/libc.so.6
    - /lib64/ld-linux-x86-64.so.2

requirements:
  host:
  run:
    - openjdk >=11
    - python >=3.8
    - philosopher =4.2.2
    - msfragger =3.5

test:
  commands:
    # - which fragpipe
    - fragpipe --help  2>&1 | grep 'FragPipe'

about:
  home: https://github.com/Nesvilab/FragPipe
  license: GNU General Public License v3.0
  license_family: GPL
  summary:  Pipeline for comprehensive analysis of shotgun proteomics data
  description: |
    FragPipe is a Java Graphical User Interface (GUI) for a suite of computational tools
    enabling comprehensive analysis of mass spectrometry-based proteomics data.
    It is powered by MSFragger - an ultrafast proteomic search engine suitable
    for both conventional and "open" (wide precursor mass tolerance) peptide identification.
    FragPipe includes the Philosopher toolkit for downstream post-processing of
    MSFragger search results (PeptideProphet, iProphet, ProteinProphet), FDR filtering,
    label-based quantification, and multi-experiment summary report generation.
    Crystal-C and PTM-Shepherd are included to aid interpretation of open search results.
    Also included in FragPipe binary are TMT-Integrator for TMT/iTRAQ isobaric
    labeling-based quantification, IonQuant for label-free quantification with
    match-between-run (MBR) functionality, SpectraST and EasyPQP spectral library building modules,
    and DIA-Umpire SE module for direct analysis of data independent acquisition (DIA) data.

extra:
  notes: |
    For example run it with "IonQuant -Xms512m -Xmx16g"
  identifiers:
    - biotools:fragpipe
    - doi:10.1074/mcp.TIR120.002048
