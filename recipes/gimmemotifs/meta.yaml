{% set name = "gimmemotifs" %}
{% set version = "0.18.0" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  url: https://github.com/vanheeringen-lab/gimmemotifs/releases/download/{{ version }}/gimmemotifs-{{ version }}.tar.gz
  sha256: 8e7d23a898174a962c845b22433a74e3ddde619c5d77f3a5b5dbfb8fa61e7351

build:
  number: 7
  run_exports:
    - {{ pin_subpackage('gimmemotifs', max_pin="x.x") }}
    - {{ pin_subpackage('gimmemotifs-minimal', max_pin="x.x") }}

outputs:
  - name: {{ name }}-minimal

    build:
      script:
        - export LDFLAGS="${LDFLAGS} -L${PREFIX}/lib"
        - export CPPFLAGS="${CPPFLAGS} -I${PREFIX}/include"
        - export CFLAGS="${CFLAGS} -O3 -Wno-deprecated-declarations -Wno-implicit-int -Wno-int-conversion"
        - sed -i.bak 's|find_packages|find_namespace_packages|' setup.py
        - sed -i.bak 's|"CONDA_BUILD"|"PREFIX"|' setup.py
        - sed -i.bak 's|SafeConfigParser|ConfigParser|' versioneer.py
        - sed -i.bak 's|readfp|read_file|' versioneer.py
        - python -m pip install . --no-deps --no-build-isolation --no-cache-dir --use-pep517 -vvv
      skip: True  # [py < 37]

    requirements:
      build:
        - {{ compiler('c') }}
      host:
        - python
        - pip
        - libgomp  # [linux]
        - llvm-openmp  # [osx]
      run:
        - libgomp  # [linux]
        - llvm-openmp  # [osx]
        - biofluff >=3.0.4              # Necessary for coverage_table()
        - configparser
        - diskcache
        - feather-format
        - genomepy >=0.13.0
        - iteround
        - jinja2
        - logomaker
        - loguru
        - matplotlib-base >=3.3         # https://matplotlib.org/stable/devel/min_dep_policy.html#list-of-dependency-versions
        - numpy >=1.18                  # https://numpy.org/neps/nep-0029-deprecation_policy.html#support-table
        - pandas >=1.3
        - pybedtools >=0.9.0
        - pysam >=0.16
        - python
        - python-xxhash
        - qnorm  >=0.8.1
        - scikit-learn >=0.23.2         # https://scikit-learn.org/stable/install.html#installing-the-latest-release
        - scipy >=1.5                   # https://docs.scipy.org/doc/scipy/dev/toolchain.html#numpy
        - seaborn-base >=0.10.1
        - statsmodels
        - tqdm >=4.46.1
        - xdg

  - name: gimmemotifs

    requirements:
      run:
        - gimmemotifs-minimal ={{ version }}
        # - ipywidgets                    # bloats environment
        # - xgboost >=1.0.2               # bloats environment
        - dinamo >=1.0
        - gadem >=1.3.1  # [not arm64]
        - homer >=4.11  # [not osx]
        - meme >=5.5.7
        - prosampler >=1.5
        - trawler >=2.0   # [not arm64]
        - weeder >=2.0  # [not osx]
        - xxmotif >=1.6  # [not osx]
        #  - yamda >=0.1.00e9c9d          # bloats environment

test:
  commands:
    - export LD_PRELOAD="${PREFIX}/lib/libgomp.so.1" && gimme --help

about:
  home: "https://github.com/vanheeringen-lab/gimmemotifs"
  license: MIT
  license_family: MIT
  license_file: COPYING
  summary: "Motif prediction pipeline and various motif-related tools."
  description: "Motif prediction pipeline and various motif-related tools."
  dev_url: "https://github.com/vanheeringen-lab/gimmemotifs"
  doc_url: "https://gimmemotifs.readthedocs.io/en/master"

extra:
  additional-platforms:
    - linux-aarch64
    - osx-arm64
  recipe-maintainers:
    - simonvh
    - siebrenf
  identifiers:
    - biotools:gimmemotifs
    - doi:10.1093/bioinformatics/btq636
    - doi:10.1101/474403
