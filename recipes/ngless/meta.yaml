{% set name = "ngless" %}
{% set version = "1.1.1" %}
{% set sha256 = "c83648cf6359edea6987b708ea08bd7f4731bd8a8ca3e7a0cfaea2a60fa4ae0c" %}

{% set ghc_src_version_linux = "8.6.5" %}
{% set ghc_src_sha256_linux = "4d4aa1e96f4001b934ac6193ab09af5d6172f41f5a5d39d8e43393b9aafee361" %}
{% set ghc_bootstrap_version_linux = "8.4.2" %}
{% set ghc_bootstrap_linux_sha256_linux = "28c31489ed9a83af4400685ec8bc72a6d43d08958d75b2dc35d29a894a5c9d93" %}

{% set ghc_version_macosx = "8.6.5" %}
{% set ghc_sha256_macosx = "dfc1bdb1d303a87a8552aa17f5b080e61351f2823c2b99071ec23d0837422169" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  - url: https://github.com/ngless-toolkit/ngless/archive/v{{ version }}.tar.gz
    sha256: {{ sha256 }}
    folder: ngless

  - url: https://downloads.haskell.org/~ghc/{{ ghc_bootstrap_version_linux }}/ghc-{{ ghc_bootstrap_version_linux }}-x86_64-centos67-linux.tar.xz  # [linux]
    sha256: {{ ghc_bootstrap_linux_sha256_linux }}  # [linux]
    folder: ghc_bootstrap # [linux]

  - url: https://downloads.haskell.org/~ghc/{{ ghc_src_version_linux }}/ghc-{{ ghc_src_version_linux }}-src.tar.xz # [linux]
    sha256: {{ ghc_src_sha256_linux }} # [linux]
    folder: ghc_src # [linux]

  - url: https://downloads.haskell.org/~ghc/{{ ghc_version_macosx }}/ghc-{{ ghc_version_macosx }}-x86_64-apple-darwin.tar.xz # [osx]
    sha256: {{ ghc_sha256_macosx }} # [osx]
    folder: ghc # [osx]

build:
  number: 1
  skip: True # [linux]

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - make
    - perl
    - coreutils
    - binutils
    - pkg-config
    - automake
    - autoconf
    - libtool
    - stack >=1.9.3
  host:
    - gmp
    - xz
    - zlib
    - bzip2
    - backports.lzma
    - libiconv
    - openssh
    - wget
  run:
    - python

test:
  commands:
    - ngless --version
    - ngless --check-install

about:
  home: https://ngless.embl.de
  license: MIT
  summary: A tool for short-read processing with a focus on metagenomics

extra:
  container:
    # For GHC
    extended-base: true
  recipe-maintainers:
    - luispedro
  identifiers:
    - "doi:10.1186/s40168-019-0684-8" # Publication
