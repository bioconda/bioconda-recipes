{% set name = "regenie" %}
{% set version = "4.1.2" %}
{% set sha256 = "9b78c2fe9b16f231d7f8402acd2b9c617f0264215b63a0b7056eeff6fdcd2a9f" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  url: https://github.com/rgcgithub/regenie/archive/v{{ version }}.tar.gz
  sha256: {{ sha256 }}
  patches:
    # Fixing postrelease issues
    - patches/0015-update-cmakelist.txt-for-v3.6.patch

build:
  number: 1
  skip: true # [osx]
  run_exports:
    - {{ pin_subpackage('regenie', max_pin="x") }}

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - {{ compiler('fortran') }}
    - binutils >=2.33.1              # [linux]
    - pkg-config
    - cmake >=3.13
    - make
  host:
    - bgenix >=1.1.7
    - boost-cpp 1.74
    - liblapack * *mkl               # [x86_64]
    - liblapack >=3.8.0              # [linux and aarch64]
    - mkl >=2020.4                   # [x86_64]
    - mkl-include                    # [x86_64]
    - llvm-openmp                    # [osx]
    - libgomp                        # [linux]
    - zlib
    - zstd
    - liblapack * *openblas  # [osx]  
    - openblas >=0.3.20      # [osx] 
  run:
    - boost-cpp 1.74
    - mkl >=2020.4                   # [x86_64]
    - sqlite
    - llvm-openmp                    # [osx]
    - libgomp                        # [linux]
    - openblas >=0.3.20      # [osx]

test:
  commands:
    - test -f ${PREFIX}/bin/regenie  # [linux]
    - regenie --help
    - regenie --version

about:
  home: "https://rgcgithub.github.io/regenie"
  license: MIT
  license_family: MIT
  license_file: LICENSE
  summary: "Regenie is a C++ program for whole genome regression modelling of large genome-wide association studies (GWAS)."
  dev_url: "https://github.com/rgcgithub/regenie"
  doc_url: "https://rgcgithub.github.io/regenie/options"

extra:
  recipe-maintainers:
    - matuskosut
    - joellembatchou
  additional-platforms:
    - linux-aarch64
